{% extends "cabecalho-rodape.html" %}
{% block content %}
    <link rel="stylesheet" href="/Static/carrinho.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<div class="table-container">
    <table class="tabela">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Preço</th>
                <th>Quantidade</th>
                <th>Subtotal</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            <tr class="produto">
                <td>Nome do Produto 1</td>
                <td class="preco">R$ 100,00</td>
                <td><input type="number" class="quantidade" min="1" max="10" value="1" onchange="atualizarSubtotal(this)"></td>
                <td class="subtotal">R$ 100,00</td>
                <td class="acoes"><i class="fas fa-trash-alt" onclick="removerProduto(this)"></i></td>
            </tr>
            <tr class="produto">
                <td>Nome do Produto 2</td>
                <td class="preco">R$ 100,00</td>
                <td><input type="number" class="quantidade" min="1" max="10" value="1" onchange="atualizarSubtotal(this)"></td>
                <td class="subtotal">R$ 100,00</td>
                <td class="acoes"><i class="fas fa-trash-alt" onclick="removerProduto(this)"></i></td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4">Total</td>
                <td id="total">R$ 200,00</td>
            </tr>
            <tr>
                <td colspan="5">
                    <button class="comprar-tudo">Comprar Tudo</button>
                </td>
            </tr>
        </tfoot>
    </table>
</div>

<script>
function alerta(quantidade, callback) {
    var mensagem = `Tem certeza de que deseja excluir ${quantidade} item(s)?`;
    var r = confirm(mensagem);
    if (r == true) {
        if (callback && typeof callback === 'function') {
            callback();
        }
    }
}

function atualizarSubtotal(element) {
    const produtoRow = element.closest('.produto');
    const precoTexto = produtoRow.querySelector('.preco').textContent;
    const preco = parseFloat(precoTexto.replace('R$ ', '').replace(',', '.'));
    const quantidade = parseInt(element.value);
    const subtotal = preco * quantidade;
    produtoRow.querySelector('.subtotal').textContent = `R$ ${subtotal.toFixed(2).replace('.', ',')}`;
    atualizarTotal();
}

function atualizarTotal() {
    let total = 0;
    document.querySelectorAll('.subtotal').forEach(subtotalElement => {
        const subtotalTexto = subtotalElement.textContent;
        const subtotal = parseFloat(subtotalTexto.replace('R$ ', '').replace(',', '.'));
        total += subtotal;
    });
    document.getElementById('total').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
}

function removerProduto(element) {
    const quantidade = parseInt(element.closest('.produto').querySelector('.quantidade').value);
    alerta(quantidade, function() { // Passando uma função de retorno de chamada como segundo parâmetro
        const produtoRow = element.closest('.produto');
        produtoRow.remove();
        atualizarTotal();
    });
}

window.onload = atualizarTotal;
</script>

{% endblock %}